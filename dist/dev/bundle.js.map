{"version":3,"file":"bundle.js.map","sources":["../Users/zhengqiguang/Work/github/QV/src/common/selector.js","../Users/zhengqiguang/Work/github/QV/src/core/compiler.js","../Users/zhengqiguang/Work/github/QV/src/core/render.js","../Users/zhengqiguang/Work/github/QV/src/core/event-loop.js","../Users/zhengqiguang/Work/github/QV/src/core/node.js","../Users/zhengqiguang/Work/github/QV/src/core/watcher.js","../Users/zhengqiguang/Work/github/QV/src/core/data.js","../Users/zhengqiguang/Work/github/QV/src/core/core.js","../Users/zhengqiguang/Work/github/QV/src/index.js"],"sourcesContent":["/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nexport default {\n    s(selector = \"\"){ //单个\n        return document.querySelector(selector);\n    },\n    m(selector = \"\"){// 集合\n        return document.querySelectorAll(selector);\n    },\n    id(id = \"\"){\n        return document.getElementById(id);\n    }\n\n}\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nlet tplDataArgsName = \"od\";\n\nconst compiler_helper = {\n    generaltplFn(tpl){\n        let patt = new RegExp(\"\\{\\{\\[ \\\\t\\]\\*\\(\\[\\@\\#\\]\\?\\)\\(\\\\\\/\\?\\)\\(\\[\\\\w\\\\W\\]\\*\\?\\)\\[ \\\\t\\]\\*\\}\\}\", \"g\"),\n            result;\n\n        let tempStrFn = \"\",\n            fnArgs = [],\n            cursor = 0;\n\n\n        while ((result = patt.exec(tpl)) !== null) {\n            var $temp1 = tpl.slice(cursor, result.index);\n            cursor += $temp1.length;\n\n            tempStrFn += this.wrapStaticBlock($temp1);\n\n            // let $temp2 = tpl.slice(cursor, cursor + result[0].length);\n\n            fnArgs.push(result[3]);\n            tempStrFn += this.wrapDynamicBlock(result);\n            cursor += result[0].length;\n        }\n\n        let tempLast = tpl.slice(cursor, tpl.length);\n\n\n        tempStrFn += this.wrapStaticBlock(tempLast);\n\n        let tplFn = this.gTplFn(tempStrFn);\n\n        return {\n            tplFn: tplFn,\n            linkArgs: fnArgs\n        }\n    },\n    wrapStaticBlock: function (str) {\n\n        return \"\\'\" + str + \"\\'\";\n\n    },\n    wrapDynamicBlock: function (result) {\n\n        return \" + od.\" + result[3] + \" + \"\n    },\n    gTplFn: function (str) {\n\n        let $t = \"console.log(od); return \" + str;\n\n        $t = $t.replace(/\\n/g, \"\");\n\n        let $tempFn = new Function(\"od\", $t);\n\n        return $tempFn;\n\n    }\n\n\n}\n\n\nclass Compiler {\n\n\n    constructor(tpl) {\n        this.tpl = tpl;\n        this.init(compiler_helper.generaltplFn(this.tpl));\n    }\n\n    init({tplFn, linkArgs}) {\n        this.tplFn = tplFn;\n        this.linkArgs = linkArgs;\n    }\n\n}\n\n\nexport default Compiler;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\n\n\nconst render = {\n\n    mount($node, $data){\n\n        let $newDom = this.generalDom($node.$tplfn($data));\n\n        this.replaceNode($newDom, $node);\n\n    },\n\n    generalDom(domStr){\n        var $temp = document.createElement(\"div\");\n        $temp.innerHTML = domStr.trim(); //不然会有多余的空格等东西\n        return $temp.childNodes[0];\n    },\n\n    replaceNode(newDom, node){\n        let $el = node.$el;\n\n        $el.parentNode.replaceChild(newDom, $el);\n\n        node.$el = newDom;\n    }\n\n\n}\n\n\nexport default render;","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\n\nlet EventLoop = {\n    d_o(fn){\n        let p = Promise.resolve();\n        p.then(fn).catch((e) => {\n            console.log(e);\n        });\n    }\n\n}\n\nexport default EventLoop;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nimport selector from  \"../common/selector\";\n\nimport Compiler from \"./compiler\"\n\nimport Render  from \"./render\";\n\nimport EventLoop from \"./event-loop\";\n\nclass Node {\n\n    constructor({el, template, data}) {\n        this.$data = data;\n        this.el = el;\n        this.template = template;\n        this.$el = selector.s(this.el);\n\n        let $t = selector.s(this.template);\n        if ($t) {\n            this.$template = $t.innerHTML.trim();\n        } else {\n            //error\n        }\n        this.$compiler = new Compiler(this.$template);\n\n        this.$args = this.$compiler.linkArgs;\n        this.$tplfn = this.$compiler.tplFn;\n    }\n\n    update() {\n        EventLoop.d_o(Render.mount.bind(Render, this, this.$data));\n    }\n\n}\n\nexport default Node;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nclass Watcher {\n    constructor(data) {\n        this.$data = data;\n        this.mountWatcher();\n\n    }\n\n    mountWatcher() {\n\n        let od = this.$data[\"_od_\"];\n\n        for (let key in this.$data) {\n\n            (function (key) {\n\n                let timeoutHandler = null;\n\n                if (key !== \"_od_\" && !od[key].mounted) {\n                    if (!od[key]) {\n                        throw new Error(`data:${key} is init `);\n                    }\n                    Object.defineProperty(this.$data, key, {\n                        get () {\n                            return od[key].value;\n                        },\n                        set(value) {\n                            clearTimeout(timeoutHandler);\n                            setTimeout(() => {\n                                if (value !== od[key].value) {\n                                    var $n = od[key].linkNodes;\n                                    od[key].value = value;\n                                    for (var i = 0, n; n = $n[i]; i++) {\n                                        n.update();\n                                    }\n                                }\n                            }, 1000 / 60);//一帧节流\n\n                        }\n                    });\n                    od[key].mounted = true;\n                }\n            }.bind(this))(key);\n\n        }\n    }\n\n    linkNode($node) {\n\n        for (let i = 0, n; n = $node.$args[i]; i++) {\n            if (this.$data[n] &&\n                this.$data[\"_od_\"][n] &&\n                this.$data[\"_od_\"][n].linkNodes.indexOf($node) === -1) {\n                this.$data[\"_od_\"][n].linkNodes.push($node);\n            }\n        }\n    }\n\n\n    updateData() {\n\n\n    }\n\n\n}\n\n\nexport default Watcher;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nconst helper = {\n    insertOD($targetData, $data){\n\n        !$targetData && ($targetData = {});\n\n        for (var key in $data) {\n            $targetData[key] = {\n                value: $data[key],\n                linkNodes: [],\n                mounted: false\n            }\n        }\n\n        return $targetData;\n\n    }\n\n\n}\n\nclass Data {\n\n    static formatData(data = {}) {\n        data[\"_od_\"] = helper.insertOD(data[\"_od_\"], data);\n        return data;\n    }\n\n\n}\n\nexport default Data;\n","/**\n * Created by zhengqiguang on 2017/6/14.\n */\n\nimport Node from \"./node\";\nimport Watcher from \"./watcher\";\nimport Data from \"./data\";\nimport render from \"./render\";\n\nclass QV {\n    constructor(opt = {}) {\n        this._$opt = opt;\n        this.formatOption(opt);\n\n        this.mountRoot();\n\n    }\n\n    formatOption(opt) {\n\n        this.$data = Data.formatData(opt.data);\n\n        this.$root = new Node(opt);\n\n        this.$watcher = new Watcher(this.$data);\n\n        this.$watcher.linkNode(this.$root);\n\n    }\n\n    mountRoot() {\n        render.mount(this.$root, this.$data);\n    }\n\n\n}\n\n\nexport  default QV;\n","/**\n * Created by zhengqiguang on 2017/6/14.\n */\n\n\nimport Core from \"./core/core\";\n\n\n\nexport default Core;\n"],"names":["selector","document","querySelector","querySelectorAll","id","getElementById","compiler_helper","tpl","patt","RegExp","result","tempStrFn","fnArgs","cursor","exec","$temp1","slice","index","length","wrapStaticBlock","push","wrapDynamicBlock","tempLast","tplFn","gTplFn","str","$t","replace","$tempFn","Function","Compiler","init","generaltplFn","linkArgs","render","$node","$data","$newDom","generalDom","$tplfn","replaceNode","domStr","$temp","createElement","innerHTML","trim","childNodes","newDom","node","$el","parentNode","replaceChild","EventLoop","fn","p","Promise","resolve","then","catch","e","log","Node","el","template","data","s","$template","$compiler","$args","d_o","Render","mount","bind","Watcher","mountWatcher","od","key","timeoutHandler","mounted","Error","defineProperty","value","$n","linkNodes","i","n","update","indexOf","helper","$targetData","Data","insertOD","QV","opt","_$opt","formatOption","mountRoot","formatData","$root","$watcher","linkNode"],"mappings":";;;;;;AAAA;;;;AAIA,eAAe;KAAA,eACK;YAAdA,QAAc,uEAAH,EAAG;;eACLC,SAASC,aAAT,CAAuBF,QAAvB,CAAP;KAFO;KAAA,eAIK;YAAdA,QAAc,uEAAH,EAAG;;eACLC,SAASE,gBAAT,CAA0BH,QAA1B,CAAP;KALO;MAAA,gBAOA;YAARI,GAAQ,uEAAH,EAAG;;eACAH,SAASI,cAAT,CAAwBD,GAAxB,CAAP;;CARR;;;;;;;;;;;;;;;;;;;;;;;;;;ACJA;;;;AAIA,AAEA,IAAME,kBAAkB;gBAAA,wBACPC,GADO,EACH;YACTC,OAAO,IAAIC,MAAJ,CAAW,wEAAX,EAAqF,GAArF,CAAX;YACIC,eADJ;;YAGIC,YAAY,EAAhB;YACIC,SAAS,EADb;YAEIC,SAAS,CAFb;;eAKO,CAACH,SAASF,KAAKM,IAAL,CAAUP,GAAV,CAAV,MAA8B,IAArC,EAA2C;gBACnCQ,SAASR,IAAIS,KAAJ,CAAUH,MAAV,EAAkBH,OAAOO,KAAzB,CAAb;sBACUF,OAAOG,MAAjB;;yBAEa,KAAKC,eAAL,CAAqBJ,MAArB,CAAb;;;;mBAIOK,IAAP,CAAYV,OAAO,CAAP,CAAZ;yBACa,KAAKW,gBAAL,CAAsBX,MAAtB,CAAb;sBACUA,OAAO,CAAP,EAAUQ,MAApB;;;YAGAI,WAAWf,IAAIS,KAAJ,CAAUH,MAAV,EAAkBN,IAAIW,MAAtB,CAAf;;qBAGa,KAAKC,eAAL,CAAqBG,QAArB,CAAb;;YAEIC,QAAQ,KAAKC,MAAL,CAAYb,SAAZ,CAAZ;;eAEO;mBACIY,KADJ;sBAEOX;SAFd;KA9BgB;;qBAmCH,yBAAUa,GAAV,EAAe;;eAErB,OAAOA,GAAP,GAAa,IAApB;KArCgB;sBAwCF,0BAAUf,MAAV,EAAkB;;eAEzB,WAAWA,OAAO,CAAP,CAAX,GAAuB,KAA9B;KA1CgB;YA4CZ,gBAAUe,GAAV,EAAe;;YAEfC,KAAK,6BAA6BD,GAAtC;;aAEKC,GAAGC,OAAH,CAAW,KAAX,EAAkB,EAAlB,CAAL;;YAEIC,UAAU,IAAIC,QAAJ,CAAa,IAAb,EAAmBH,EAAnB,CAAd;;eAEOE,OAAP;;;CApDR;;IA4DME;sBAGUvB,GAAZ,EAAiB;;;aACRA,GAAL,GAAWA,GAAX;aACKwB,IAAL,CAAUzB,gBAAgB0B,YAAhB,CAA6B,KAAKzB,GAAlC,CAAV;;;;;mCAGoB;gBAAlBgB,KAAkB,QAAlBA,KAAkB;gBAAXU,QAAW,QAAXA,QAAW;;iBACfV,KAAL,GAAaA,KAAb;iBACKU,QAAL,GAAgBA,QAAhB;;;;;;AC5ER;;;;AAMA,IAAMC,SAAS;SAAA,iBAELC,KAFK,EAEEC,KAFF,EAEQ;;YAEXC,UAAU,KAAKC,UAAL,CAAgBH,MAAMI,MAAN,CAAaH,KAAb,CAAhB,CAAd;;aAEKI,WAAL,CAAiBH,OAAjB,EAA0BF,KAA1B;KANO;cAAA,sBAUAM,MAVA,EAUO;YACVC,QAAQzC,SAAS0C,aAAT,CAAuB,KAAvB,CAAZ;cACMC,SAAN,GAAkBH,OAAOI,IAAP,EAAlB,CAFc;eAGPH,MAAMI,UAAN,CAAiB,CAAjB,CAAP;KAbO;eAAA,uBAgBCC,MAhBD,EAgBSC,IAhBT,EAgBc;YACjBC,MAAMD,KAAKC,GAAf;;YAEIC,UAAJ,CAAeC,YAAf,CAA4BJ,MAA5B,EAAoCE,GAApC;;aAEKA,GAAL,GAAWF,MAAX;;CArBR;;ACNA;;;;AAKA,IAAIK,YAAY;OAAA,eACRC,EADQ,EACL;YACCC,IAAIC,QAAQC,OAAR,EAAR;UACEC,IAAF,CAAOJ,EAAP,EAAWK,KAAX,CAAiB,UAACC,CAAD,EAAO;oBACZC,GAAR,CAAYD,CAAZ;SADJ;;CAHR;;ACLA;;;;AAIA,IAQME;wBAEgC;YAArBC,EAAqB,QAArBA,EAAqB;YAAjBC,QAAiB,QAAjBA,QAAiB;YAAPC,IAAO,QAAPA,IAAO;;;aACzB5B,KAAL,GAAa4B,IAAb;aACKF,EAAL,GAAUA,EAAV;aACKC,QAAL,GAAgBA,QAAhB;aACKd,GAAL,GAAWjD,SAASiE,CAAT,CAAW,KAAKH,EAAhB,CAAX;;YAEIpC,KAAK1B,SAASiE,CAAT,CAAW,KAAKF,QAAhB,CAAT;YACIrC,EAAJ,EAAQ;iBACCwC,SAAL,GAAiBxC,GAAGkB,SAAH,CAAaC,IAAb,EAAjB;SADJ,MAEO;;;aAGFsB,SAAL,GAAiB,IAAIrC,QAAJ,CAAa,KAAKoC,SAAlB,CAAjB;;aAEKE,KAAL,GAAa,KAAKD,SAAL,CAAelC,QAA5B;aACKM,MAAL,GAAc,KAAK4B,SAAL,CAAe5C,KAA7B;;;;;iCAGK;sBACK8C,GAAV,CAAcC,OAAOC,KAAP,CAAaC,IAAb,CAAkBF,MAAlB,EAA0B,IAA1B,EAAgC,KAAKlC,KAArC,CAAd;;;;;;ACjCR;;;;IAIMqC;qBACUT,IAAZ,EAAkB;;;aACT5B,KAAL,GAAa4B,IAAb;aACKU,YAAL;;;;;uCAIW;;gBAEPC,KAAK,KAAKvC,KAAL,CAAW,MAAX,CAAT;;iBAEK,IAAIwC,GAAT,IAAgB,KAAKxC,KAArB,EAA4B;;2BAEbwC,GAAV,EAAe;;wBAERC,iBAAiB,IAArB;;wBAEID,QAAQ,MAAR,IAAkB,CAACD,GAAGC,GAAH,EAAQE,OAA/B,EAAwC;4BAChC,CAACH,GAAGC,GAAH,CAAL,EAAc;kCACJ,IAAIG,KAAJ,WAAkBH,GAAlB,eAAN;;+BAEGI,cAAP,CAAsB,KAAK5C,KAA3B,EAAkCwC,GAAlC,EAAuC;+BAAA,oBAC5B;uCACID,GAAGC,GAAH,EAAQK,KAAf;6BAF+B;+BAAA,kBAI/BA,KAJ+B,EAIxB;6CACMJ,cAAb;2CACW,YAAM;wCACTI,UAAUN,GAAGC,GAAH,EAAQK,KAAtB,EAA6B;4CACrBC,KAAKP,GAAGC,GAAH,EAAQO,SAAjB;2CACGP,GAAH,EAAQK,KAAR,GAAgBA,KAAhB;6CACK,IAAIG,IAAI,CAAR,EAAWC,CAAhB,EAAmBA,IAAIH,GAAGE,CAAH,CAAvB,EAA8BA,GAA9B,EAAmC;8CAC7BE,MAAF;;;iCALZ,EAQG,OAAO,EARV,EAFO;;yBAJf;2BAkBGV,GAAH,EAAQE,OAAR,GAAkB,IAAlB;;iBA1BP,EA4BCN,IA5BD,CA4BM,IA5BN,CAAD,CA4BcI,GA5Bd;;;;;iCAiCCzC,OAAO;;iBAEP,IAAIiD,IAAI,CAAR,EAAWC,CAAhB,EAAmBA,IAAIlD,MAAMiC,KAAN,CAAYgB,CAAZ,CAAvB,EAAuCA,GAAvC,EAA4C;oBACpC,KAAKhD,KAAL,CAAWiD,CAAX,KACA,KAAKjD,KAAL,CAAW,MAAX,EAAmBiD,CAAnB,CADA,IAEA,KAAKjD,KAAL,CAAW,MAAX,EAAmBiD,CAAnB,EAAsBF,SAAtB,CAAgCI,OAAhC,CAAwCpD,KAAxC,MAAmD,CAAC,CAFxD,EAE2D;yBAClDC,KAAL,CAAW,MAAX,EAAmBiD,CAAnB,EAAsBF,SAAtB,CAAgC/D,IAAhC,CAAqCe,KAArC;;;;;;qCAMC;;;;;AC9DjB;;;;AAIA,IAAMqD,SAAS;YAAA,oBACFC,WADE,EACWrD,KADX,EACiB;;SAEvBqD,WAAD,KAAiBA,cAAc,EAA/B;;aAEK,IAAIb,GAAT,IAAgBxC,KAAhB,EAAuB;wBACPwC,GAAZ,IAAmB;uBACRxC,MAAMwC,GAAN,CADQ;2BAEJ,EAFI;yBAGN;aAHb;;;eAOGa,WAAP;;CAbR;;IAoBMC;;;;;;;qCAE2B;gBAAX1B,IAAW,uEAAJ,EAAI;;iBACpB,MAAL,IAAewB,OAAOG,QAAP,CAAgB3B,KAAK,MAAL,CAAhB,EAA8BA,IAA9B,CAAf;mBACOA,IAAP;;;;;;AC5BR;;;;AAIA,IAKM4B;kBACoB;YAAVC,GAAU,uEAAJ,EAAI;;;aACbC,KAAL,GAAaD,GAAb;aACKE,YAAL,CAAkBF,GAAlB;;aAEKG,SAAL;;;;;qCAISH,KAAK;;iBAETzD,KAAL,GAAasD,KAAKO,UAAL,CAAgBJ,IAAI7B,IAApB,CAAb;;iBAEKkC,KAAL,GAAa,IAAIrC,IAAJ,CAASgC,GAAT,CAAb;;iBAEKM,QAAL,GAAgB,IAAI1B,OAAJ,CAAY,KAAKrC,KAAjB,CAAhB;;iBAEK+D,QAAL,CAAcC,QAAd,CAAuB,KAAKF,KAA5B;;;;oCAIQ;mBACD3B,KAAP,CAAa,KAAK2B,KAAlB,EAAyB,KAAK9D,KAA9B;;;;;;AC/BR;;;;;;;;;;"}